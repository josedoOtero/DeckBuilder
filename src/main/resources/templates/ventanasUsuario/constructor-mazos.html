<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crear Mazo</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link th:href="@{/css/header.css}" rel="stylesheet">

    <style>
        html, body {
            height: 100%;
            margin: 0;
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }

        #pantalla {
            display: flex;
            height: 100vh;
            width: 100%;
        }

        #zona_cartas {
            flex: 3;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #dee2e6;
            background-color: #fff;
        }

        #filtros_cartas_div {
            border-bottom: 2px solid #dee2e6;
            padding: 0.75rem 0.5rem;
            background-color: #f1f3f5;
            box-shadow: inset 0 -2px 4px rgba(0,0,0,0.05);
            border-radius: 8px;
        }

        #lista_cartas {
            flex: 3;
            padding: 1rem;
            overflow-y: auto;
            background-color: #fff;
        }

        #zona_mazo {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-left: 2px solid #dee2e6;
            padding: 1rem;
            background-color: #fff;
            overflow-y: auto;
        }

        #main_deck, #extra_deck, #side_deck {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 0.5rem;
            background-color: #f8f9fa;
            overflow-y: auto;
        }

        #main_deck { flex: 2; }
        #extra_deck, #side_deck { flex: 1; }

        h5, h6 {
            font-weight: 600;
            color: #333;
        }

        .form-control, .form-select {
            height: 32px;
            font-size: 0.9rem;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #lista_cartas::-webkit-scrollbar,
        #zona_mazo::-webkit-scrollbar {
            width: 6px;
        }

        #lista_cartas::-webkit-scrollbar-thumb,
        #zona_mazo::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 10px;
        }

        .mazo-img {
            transition: transform 0.3s ease;
        }

        .mazo-img:hover {
            transform: scale(1.05);
        }

        #lista_cartas .card {
            transition: transform 0.2s;
        }

        #lista_cartas .card:hover {
            transform: translateY(-2px);
        }

        .boton1 {
            position: relative;
            display: inline-block;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
            border: none;
            cursor: pointer;
            clip-path: polygon(12% 0%, 100% 0%, 88% 100%, 0% 100%);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .boton1:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }

        .boton1-secondary { background-color: #6c757d; }
        .boton1-danger { background-color: #dc3545; }
        .boton1-success { background-color: #198754; }
        .boton1-default { background-color: #0d6efd; }
        .boton1-secondary,
        .boton1-danger,
        .boton1-success,
        .boton1-default { color: #fff; }

        #paginacion { display: none; }
        .w-100 { width: 100%; }
        .btn-sm { font-size: 0.75rem; padding: 0.25rem 0.5rem; }

        .boton-clasico { border-radius: 6px; transition: all 0.25s ease; }

        #zona_mazo .btn { transition: all 0.25s ease; }
        #btnMainExtra:hover, #btnMainExtra.active-zone {
            background-color: #0d6efd !important; color: #fff !important;
            border-color: #0d6efd !important; box-shadow: 0 4px 10px rgba(13,110,253,0.35);
            transform: translateY(-2px);
        }
        #btnSide:hover, #btnSide.active-zone {
            background-color: #dc3545 !important; color: #fff !important;
            border-color: #dc3545 !important; box-shadow: 0 4px 10px rgba(220,53,69,0.35);
            transform: translateY(-2px);
        }

        .menu-carta {
            z-index: 10;
            min-width: 120px;
        }
        .menu-carta button { font-size: 0.8rem; }

        .contador-cartas {
            font-weight: bold;
        }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<div id="pantalla" class="container-fluid">

    <div id="zona_cartas">
        <div id="filtros_cartas_div" class="p-3 rounded">
            <form id="filtros_cartas">
                <div class="row g-2 mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control" name="q" placeholder="Search by text">
                    </div>
                    <div class="col-md-6">
                        <select class="form-select" name="tipo">
                            <option value="">Card Type</option>
                            <option value="Normal Monster">Normal Monster</option>
                            <option value="Effect Monster">Effect Monster</option>
                            <option value="Fusion Monster">Fusion Monster</option>
                            <option value="Ritual Monster">Ritual Monster</option>
                            <option value="Synchro Monster">Synchro Monster</option>
                            <option value="XYZ Monster">XYZ Monster</option>
                            <option value="Link Monster">Link Monster</option>
                            <option value="Pendulum Monster">Pendulum Monster</option>
                            <option value="Spell Card">Spell Card</option>
                            <option value="Trap Card">Trap Card</option>
                        </select>
                    </div>
                </div>

                <div class="row g-2 mb-2">
                    <div class="col-md-4">
                        <select class="form-select" name="tipoCarta">
                            <option value="">Monster Race</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" name="arquetipo" placeholder="Archetype">
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" name="atributo">
                            <option value="">Attribute</option>
                        </select>
                    </div>
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-md-3">
                        <input type="number" class="form-control" name="nivel" placeholder="Level">
                    </div>
                    <div class="col-md-3 d-flex gap-2">
                        <input type="number" class="form-control" name="atkMin" placeholder="ATK min">
                        <input type="number" class="form-control" name="atkMax" placeholder="ATK max">
                    </div>
                    <div class="col-md-3 d-flex gap-2">
                        <input type="number" class="form-control" name="defMin" placeholder="DEF min">
                        <input type="number" class="form-control" name="defMax" placeholder="DEF max">
                    </div>
                </div>

                <div class="row g-2">
                    <div class="col-2">
                        <button id="btnFavoritos" type="button" class="text-white btn btn-warning boton-clasico w-100">
                            <i class="bi bi-star-fill"></i> Favorite Cards
                        </button>
                    </div>
                    <div class="col-10">
                        <button name="botonFiltro" type="submit" class="btn btn-primary boton-clasico w-100">
                            <i class="bi bi-funnel-fill"></i> Apply Filters
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <div id="lista_cartas">
            <div class="row row-cols-2 row-cols-md-3 g-3"></div>
        </div>

        <div id="zona-guardado" class="border-top d-flex align-items-center justify-content-between px-2 py-1"
             style="width:100%; gap:5px; background-color:#f1f3f5;">
            <div class="d-flex align-items-center" style="gap:5px;">
                <input type="text" id="nombreMazo" class="form-control form-control-sm mx-2" placeholder="Deck name" style="width:250px; height:30px;">
                <select id="estadoMazo" class="form-select form-select-sm mx-2" style="width:150px; height:30px;">
                    <option value="publico">Public</option>
                    <option value="privado">Private</option>
                    <option value="incompleto">Incomplete</option>
                </select>
                <div style="display:flex; flex-direction:column; align-items:center;" class="mx-2">
                    <img id="cartaDestacadaPreview" src="/img/cartaDorso.jpg"
                         style="width:50px; height:65px; cursor:pointer; border:2px solid #444; border-radius:3px;"
                         title="Click to change featured card">
                    <input type="hidden" id="cartaDestacada" value="/img/cartaDorso.jpg">
                </div>
            </div>

            <div id="paginacion" class="justify-content-center align-items-center mt-3 gap-2 border-top py-2 px-3 rounded bg-light shadow-sm"></div>

            <div class="d-flex align-items-center" style="gap:5px;">
                <button id="btnExport" class="boton1 boton1-secondary btn-sm px-2 w-auto">Export</button>
                <button id="btnShort" class="boton1 boton1-default btn-sm px-2 w-auto">Sort</button>
                <button id="btnDelete" class="boton1 boton1-danger btn-sm px-2 w-auto">Delete</button>
                <button id="btnSave" class="boton1 boton1-success btn-sm px-2 w-auto">Save</button>
            </div>
        </div>
    </div>

    <div id="zona_mazo" class="p-3">
        <div class="d-flex justify-content-around mb-3">
            <button id="btnMainExtra" class="btn btn-outline-primary boton-clasico btn-sm w-auto">Main / Extra Deck</button>
            <button id="btnSide" class="btn btn-outline-danger boton-clasico btn-sm w-auto">Side Deck</button>
        </div>

        <div id="main_deck" class="mb-3 flex-grow-2">
            <h6 class="text-muted d-flex justify-content-between align-items-center">
                <span>Main Deck</span>
                <span class="contador-cartas">0/60</span>
            </h6>
            <div class="row row-cols-5 g-1"></div>
        </div>

        <div id="extra_deck" class="mb-3 flex-grow-1">
            <h6 class="text-muted d-flex justify-content-between align-items-center">
                <span>Extra Deck</span>
                <span class="contador-cartas">0/15</span>
            </h6>
            <div class="row row-cols-5 g-1"></div>
        </div>

        <div id="side_deck" class="flex-grow-1">
            <h6 class="text-muted d-flex justify-content-between align-items-center">
                <span>Side Deck</span>
                <span class="contador-cartas">0/15</span>
            </h6>
            <div class="row row-cols-5 g-1"></div>
        </div>
    </div>

</div>

<div class="modal fade" id="modalCarta" tabindex="-1" aria-labelledby="modalCartaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark text-white border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="modalCartaLabel">Card</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex flex-column align-items-center">
                <img id="imgCartaModal" src="" alt="Card" style="max-width:100%; max-height:50vh; object-fit:contain; margin-bottom:1rem;">
                <div id="infoCartaModal" class="w-100 text-white"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalDestacada" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark text-white border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white">Select Featured Card</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="destacadaSelector" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;"></div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const ID_MAZO = /*[[${id}]]*/ null;
    console.log("ID_MAZO recibido:", ID_MAZO);
</script>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/crearMazo.js}"></script>
</body>
</html>